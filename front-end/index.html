<html>
<head>
<title>DL chat</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
function update() {
  $.ajax({
    method: "GET",
    url: "/get-messages",
    cache: false,
    success: function (data, status, xhr) {
      if (xhr.status == 200) {
        console.log('Successful update');
        var messageDiv = document.getElementById("messages-div");
        document.getElementById("messages-div").innerHTML = data;
        messageDiv.scrollTop = messageDiv.scrollHeight;
      }
      setTimeout(update, 2000);
    }
  });
}

function setUsername() {
    if(localStorage.username) {
        document.getElementById("userInput").value = localStorage.username;
    } else {
        var username = prompt('Please enter a username before you can use the chat room.');
        localStorage.username = username;
        document.getElementById("userInput").value = localStorage.username;
    }
};

update();

</script>
<style>
  #messages-div {
    height:90%;
    overflow-y: scroll;
  }
  p {
	font-size:20px;
  }
</style>
</head>
<body onload="setUsername();">

<div id="messages-div">
</div>

<form method ="POST" enctype="multipart/form-data" action="/new-message/" target="hiddenFrame">
<input name="message" type="text" placeholder="Message" style="width:60%;">
<input name="username" type="hidden" id="userInput">
<input type="submit" value="Send">
</form>

<iframe name="hiddenFrame" width="0" height="0" border="0" style="display: none;"></iframe>

</body>
</html>
